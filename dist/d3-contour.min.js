// https://d3js.org/d3-contour/ v2.0.0 Copyright 2020 Mike Bostock
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],r):r((t=t||self).d3=t.d3||{},t.d3)}(this,function(t,r){"use strict";var n=Array.prototype.slice;function e(t,r){return t-r}var a=t=>()=>t;function i(t,r){for(var n,e=-1,a=r.length;++e<a;)if(n=o(t,r[e]))return n;return 0}function o(t,r){for(var n=r[0],e=r[1],a=-1,i=0,o=t.length,f=o-1;i<o;f=i++){var u=t[i],c=u[0],d=u[1],l=t[f],s=l[0],g=l[1];if(h(u,l,r))return 0;d>e!=g>e&&n<(s-c)*(e-d)/(g-d)+c&&(a=-a)}return a}function h(t,r,n){var e,a,i,o;return function(t,r,n){return(r[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(r[1]-t[1])}(t,r,n)&&(a=t[e=+(t[0]===r[0])],i=n[e],o=r[e],a<=i&&i<=o||o<=i&&i<=a)}function f(){}var u=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function c(){var t=1,o=1,h=r.thresholdSturges,c=g;function d(t){var n=h(t);if(Array.isArray(n))n=n.slice().sort(e);else{var a=r.extent(t),i=a[0],o=a[1];n=r.tickStep(i,o,n),n=r.range(Math.floor(i/n)*n,Math.floor(o/n)*n,n)}return n.map(function(r){return l(t,r)})}function l(r,n){var e=[],a=[];return function(r,n,e){var a,i,h,f,c,d,l=new Array,g=new Array;a=i=-1,f=r[0]>=n,u[f<<1].forEach(v);for(;++a<t-1;)h=f,f=r[a+1]>=n,u[h|f<<1].forEach(v);u[f<<0].forEach(v);for(;++i<o-1;){for(a=-1,f=r[i*t+t]>=n,c=r[i*t]>=n,u[f<<1|c<<2].forEach(v);++a<t-1;)h=f,f=r[i*t+t+a+1]>=n,d=c,c=r[i*t+a+1]>=n,u[h|f<<1|c<<2|d<<3].forEach(v);u[f|c<<3].forEach(v)}a=-1,c=r[i*t]>=n,u[c<<2].forEach(v);for(;++a<t-1;)d=c,c=r[i*t+a+1]>=n,u[c<<2|d<<3].forEach(v);function v(t){var r,n,o=[t[0][0]+a,t[0][1]+i],h=[t[1][0]+a,t[1][1]+i],f=s(o),u=s(h);(r=g[f])?(n=l[u])?(delete g[r.end],delete l[n.start],r===n?(r.ring.push(h),e(r.ring)):l[r.start]=g[n.end]={start:r.start,end:n.end,ring:r.ring.concat(n.ring)}):(delete g[r.end],r.ring.push(h),g[r.end=u]=r):(r=l[u])?(n=g[f])?(delete l[r.start],delete g[n.end],r===n?(r.ring.push(h),e(r.ring)):l[n.start]=g[r.end]={start:n.start,end:r.end,ring:n.ring.concat(r.ring)}):(delete l[r.start],r.ring.unshift(o),l[r.start=f]=r):l[f]=g[u]={start:f,end:u,ring:[o,h]}}u[c<<3].forEach(v)}(r,n,function(t){c(t,r,n),function(t){for(var r=0,n=t.length,e=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++r<n;)e+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return e}(t)>0?e.push([t]):a.push(t)}),a.forEach(function(t){for(var r,n=0,a=e.length;n<a;++n)if(-1!==i((r=e[n])[0],t))return void r.push(t)}),{type:"MultiPolygon",value:n,coordinates:e}}function s(r){return 2*r[0]+r[1]*(t+1)*4}function g(r,n,e){r.forEach(function(r){var a,i=r[0],h=r[1],f=0|i,u=0|h,c=n[u*t+f];i>0&&i<t&&f===i&&(a=n[u*t+f-1],r[0]=i+(e-a)/(c-a)-.5),h>0&&h<o&&u===h&&(a=n[(u-1)*t+f],r[1]=h+(e-a)/(c-a)-.5)})}function v(t,r,n){g(t,r,n);var e=t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1];t.forEach(function(r,n){var a,i,o=r[0],h=r[1];n<t.length-1?(a=t[n+1][0],i=t[n+1][1],r[0]=o+(a-o)/2,r[1]=h+(i-h)/2):e&&(r[0]=t[0][0],r[1]=t[0][1])})}return d.contour=l,d.size=function(r){if(!arguments.length)return[t,o];var n=Math.floor(r[0]),e=Math.floor(r[1]);if(!(n>=0&&e>=0))throw new Error("invalid size");return t=n,o=e,d},d.thresholds=function(t){return arguments.length?(h="function"==typeof t?t:Array.isArray(t)?a(n.call(t)):a(t),d):h},d.smooth=function(t){return arguments.length?(c="linearDual"===t?v:t?g:f,d):c===g||c===v},d}function d(t,r,n){for(var e=t.width,a=t.height,i=1+(n<<1),o=0;o<a;++o)for(var h=0,f=0;h<e+n;++h)h<e&&(f+=t.data[h+o*e]),h>=n&&(h>=i&&(f-=t.data[h-i+o*e]),r.data[h-n+o*e]=f/Math.min(h+1,e-1+i-h,i))}function l(t,r,n){for(var e=t.width,a=t.height,i=1+(n<<1),o=0;o<e;++o)for(var h=0,f=0;h<a+n;++h)h<a&&(f+=t.data[o+h*e]),h>=n&&(h>=i&&(f-=t.data[o+(h-i)*e]),r.data[o+(h-n)*e]=f/Math.min(h+1,a-1+i-h,i))}function s(t){return t[0]}function g(t){return t[1]}function v(){return 1}t.contourDensity=function(){var t=s,e=g,i=v,o=960,h=500,f=20,u=2,w=3*f,y=o+2*w>>u,p=h+2*w>>u,E=a(20);function M(n){var a=new Float32Array(y*p),o=new Float32Array(y*p);n.forEach(function(r,n,o){var h=+t(r,n,o)+w>>u,f=+e(r,n,o)+w>>u,c=+i(r,n,o);h>=0&&h<y&&f>=0&&f<p&&(a[h+f*y]+=c)}),d({width:y,height:p,data:a},{width:y,height:p,data:o},f>>u),l({width:y,height:p,data:o},{width:y,height:p,data:a},f>>u),d({width:y,height:p,data:a},{width:y,height:p,data:o},f>>u),l({width:y,height:p,data:o},{width:y,height:p,data:a},f>>u),d({width:y,height:p,data:a},{width:y,height:p,data:o},f>>u),l({width:y,height:p,data:o},{width:y,height:p,data:a},f>>u);var h=E(a);if(!Array.isArray(h)){var s=r.max(a);h=r.tickStep(0,s,h),(h=r.range(0,Math.floor(s/h)*h,h)).shift()}return c().thresholds(h).size([y,p])(a).map(A)}function A(t){return t.value*=Math.pow(2,-2*u),t.coordinates.forEach(m),t}function m(t){t.forEach(z)}function z(t){t.forEach(x)}function x(t){t[0]=t[0]*Math.pow(2,u)-w,t[1]=t[1]*Math.pow(2,u)-w}function b(){return y=o+2*(w=3*f)>>u,p=h+2*w>>u,M}return M.x=function(r){return arguments.length?(t="function"==typeof r?r:a(+r),M):t},M.y=function(t){return arguments.length?(e="function"==typeof t?t:a(+t),M):e},M.weight=function(t){return arguments.length?(i="function"==typeof t?t:a(+t),M):i},M.size=function(t){if(!arguments.length)return[o,h];var r=+t[0],n=+t[1];if(!(r>=0&&n>=0))throw new Error("invalid size");return o=r,h=n,b()},M.cellSize=function(t){if(!arguments.length)return 1<<u;if(!((t=+t)>=1))throw new Error("invalid cell size");return u=Math.floor(Math.log(t)/Math.LN2),b()},M.thresholds=function(t){return arguments.length?(E="function"==typeof t?t:Array.isArray(t)?a(n.call(t)):a(t),M):E},M.bandwidth=function(t){if(!arguments.length)return Math.sqrt(f*(f+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return f=Math.round((Math.sqrt(4*t*t+1)-1)/2),b()},M},t.contours=c,Object.defineProperty(t,"__esModule",{value:!0})});
